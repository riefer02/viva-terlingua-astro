---
import Layout from '@/layouts/Layout.astro';
import HeroMarquee from '@/components/HeroMarquee.astro';
import Sponsors from '@/components/Sponsors.astro';
import Resources from '@/components/Resources.astro';
import Quote from '@/components/Quote.astro';
import CookoffPosterGrid from '@/components/posters/CookoffPosterGrid.astro';
import PanelImage from '@/components/PanelImage.astro';
import config from '@/config/site';
import strapi from '@/lib/api/strapi-client';
import type { HomePageResponse, HomePage } from '@/types/strapi';

const response = await strapi.find<HomePageResponse>('home-page', {
  populate: {
    featured: {
      populate: {
        featuresList: {
          populate: {
            image: {
              populate: '*',
            },
          },
        },
      },
    },
    meta: {
      populate: '*',
    },
    marqueeImage: {
      populate: '*',
    },
    panelImage: {
      populate: '*',
    },
    quoteContent: {
      populate: '*',
    },
  },
});

if (!response.data) {
  throw new Error('Homepage data not found');
}

const pageData = response.data as HomePage;
---

<Layout title={'Home'} description={config.description}>
  <HeroMarquee data={pageData} />
  <Sponsors />
  {pageData.quoteContent && <Quote quote={pageData.quoteContent} />}

  <PanelImage panelImage={pageData.panelImage} />

  <PanelImage galleryImageName="2-Alarm Chili" />

  <CookoffPosterGrid />
  <Resources />
</Layout>
